import React, { useEffect, useState } from "react";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from "recharts";

export default function App() {
  const [sensorData, setSensorData] = useState({ temperature: 0, humidity: 0, air: 0 });
  const [history, setHistory] = useState([]);

  // Fetch from backend every 5 seconds
  useEffect(() => {
    const fetchData = async () => {
      try {
        const res = await fetch("http://localhost:4000/sensors");
        const data = await res.json();
        setSensorData(data);

        // Save last 20 readings for chart
        setHistory((prev) => {
          const newData = [...prev, { ...data, time: new Date().toLocaleTimeString() }];
          return newData.slice(-20);
        });
      } catch (err) {
        console.error("Fetch error:", err);
      }
    };

    fetchData();
    const interval = setInterval(fetchData, 5000);
    return () => clearInterval(interval);
  }, []);

  return (
    <div style={{ fontFamily: "Arial, sans-serif", padding: "20px", background: "#f8f9fa" }}>
      <h1 style={{ textAlign: "center" }}>âš¡ Smart Supply Dashboard</h1>

      {/* Cards */}
      <div style={{ display: "flex", justifyContent: "center", gap: "20px", marginBottom: "30px" }}>
        <div style={{ background: "white", padding: "20px", borderRadius: "12px", boxShadow: "0 4px 8px rgba(0,0,0,0.1)" }}>
          <h2>ğŸŒ¡ Temperature</h2>
          <p style={{ fontSize: "24px" }}>{sensorData.temperature} Â°C</p>
        </div>
        <div style={{ background: "white", padding: "20px", borderRadius: "12px", boxShadow: "0 4px 8px rgba(0,0,0,0.1)" }}>
          <h2>ğŸ’§ Humidity</h2>
          <p style={{ fontSize: "24px" }}>{sensorData.humidity} %</p>
        </div>
        <div style={{ background: "white", padding: "20px", borderRadius: "12px", boxShadow: "0 4px 8px rgba(0,0,0,0.1)" }}>
          <h2>ğŸŸ¢ Air Quality</h2>
          <p style={{ fontSize: "24px" }}>{sensorData.air}</p>
        </div>
      </div>

      {/* Chart */}
      <h2 style={{ textAlign: "center" }}>ğŸ“Š Sensor Trends</h2>
      <ResponsiveContainer width="100%" height={400}>
        <LineChart data={history}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="time" />
          <YAxis />
          <Tooltip />
          <Legend />
          <Line type="monotone" dataKey="temperature" stroke="#ff7300" />
          <Line type="monotone" dataKey="humidity" stroke="#387908" />
          <Line type="monotone" dataKey="air" stroke="#007bff" />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}
